<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lesson 9: Text Analysis with Bedrock - AWS Learning Tutorial</title>

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>☁️</text></svg>">
  <link rel="stylesheet" href="../assets/style.css">
  <!-- Highlight.js for syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <!-- Additional language support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
  <script src="../assets/terraform.js"></script>
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1><a href="../index.html">AWS Learning</a></h1>
      </div>

      <div class="lesson-info">
        <h2>Lesson 9</h2>
        <div class="lesson-title">AI/ML Buzzwords (Get Your MBA!)</div>
        <div class="lesson-meta">
          <span>~6 hours</span>
          <span>$5-10</span>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-bar">
        <div class="progress-fill" style="width: 66.67%;"></div>
      </div>
      <div class="progress-text">Step 2 of 3</div>

      <!-- Table of Contents -->
      <nav class="toc">
        <h3>In This Lesson</h3>
        <ul>
          <li>
<a href="lesson-09.html">
<span class="step-number">1</span>
<span class="step-title">Image Analysis with Rekognition</span>
</a>
</li>
<li class="active">
<a href="lesson-09-2.html">
<span class="step-number">2</span>
<span class="step-title">Text Analysis with Bedrock</span>
</a>
</li>
<li>
<a href="lesson-09-3.html">
<span class="step-number">3</span>
<span class="step-title">Additional AI Services</span>
</a>
</li>

        </ul>
      </nav>

      <!-- All Lessons -->
      <div class="all-lessons">
  <h3>All Lessons</h3>
  <ul>
    <li>
      <a href="lesson-01.html">1. Your First Internet Empire</a>
    </li>
    <li>
      <a href="lesson-02.html">2. Renting Computers</a>
    </li>
    <li>
      <a href="lesson-03.html">3. Databases That Don&#39;t Die</a>
    </li>
    <li>
      <a href="lesson-04.html">4. Containers &amp; Orchestration</a>
    </li>
    <li>
      <a href="lesson-05.html">5. Serverless Computing</a>
    </li>
    <li>
      <a href="lesson-06.html">6. Data Pipelines</a>
    </li>
    <li>
      <a href="lesson-07.html">7. Event-Driven Chaos</a>
    </li>
    <li>
      <a href="lesson-08.html">8. Big Data Analytics</a>
    </li>
    <li class="current">
      <a href="lesson-09.html">9. AI/ML Buzzwords</a>
    </li>
    <li>
      <a href="lesson-10.html">10. Observability</a>
    </li>
    <li>
      <a href="lesson-11.html">11. Security Deep Dive</a>
    </li>
    <li>
      <a href="lesson-12.html">12. Final Project</a>
    </li>
  </ul>
</div>

    </aside>

    <!-- Main Content -->
    <main class="content">
      
<div class="step-header">
        <span class="step-badge">Lesson 9 - Part 2</span>
        <h1>Text Analysis with Bedrock</h1>
      </div>

      <div class="step-content">
        <h2>Part 2: Text Analysis with Bedrock (2 hours)</h2>

        <h3>Step 8: Enable Bedrock Model Access</h3>
        <pre><div class="code-block-badges"><span class="code-service-badge">Bedrock</span></div><code class="language-bash"># Note: Bedrock requires manual model access approval in console
# Go to: AWS Console → Bedrock → Model access → Request access
# Request access to: Claude 3 Haiku (cheapest/fastest)

# Check model access (will show empty until approved)
aws bedrock list-foundation-models</code></pre>

        <h3>Step 9: Test Bedrock with Claude</h3>
        <p>Create <code>test-bedrock.py</code>:</p>
        <pre><code class="language-python">import boto3
import json

bedrock = boto3.client('bedrock-runtime', region_name='us-east-1')

def analyze_text(text):
    prompt = f"""Analyze the following text for:
1. Sentiment (positive/negative/neutral)
2. Language tone (formal/casual/aggressive/friendly)
3. Any concerning content (hate speech, violence, explicit content)
4. Key topics/themes

Text: {text}

Provide your analysis in JSON format."""

    body = json.dumps({
        "anthropic_version": "bedrock-2023-05-31",
        "max_tokens": 1000,
        "messages": [
            {
                "role": "user",
                "content": prompt
            }
        ]
    })

    response = bedrock.invoke_model(
        modelId='anthropic.claude-3-haiku-20240307-v1:0',
        body=body
    )

    response_body = json.loads(response['body'].read())
    return response_body['content'][0]['text']

if __name__ == '__main__':
    test_text = "I love this product! It's absolutely amazing and works perfectly."

    analysis = analyze_text(test_text)
    print("Analysis:", analysis)</code></pre>

        <p>Run test:</p>
        <pre><code class="language-bash">python3 test-bedrock.py</code></pre>

        <h3>Step 10: Create Text Analysis Lambda</h3>
        <p>Create <code>text-analyzer/index.js</code>:</p>
        <pre><code class="language-javascript">const { BedrockRuntimeClient, InvokeModelCommand } = require('@aws-sdk/client-bedrock-runtime');
const { DynamoDBClient } = require('@aws-sdk/client-dynamodb');
const { DynamoDBDocumentClient, PutCommand } = require('@aws-sdk/lib-dynamodb');

const bedrock = new BedrockRuntimeClient({ region: 'us-east-1' });
const ddbClient = new DynamoDBClient({});
const ddb = DynamoDBDocumentClient.from(ddbClient);

async function analyzeWithClaude(text) {
  const prompt = `Analyze this text for sentiment, tone, and any concerning content. Respond in JSON format with: sentiment (positive/negative/neutral), tone (formal/casual/aggressive/friendly), isSafe (boolean), concerns (array of strings).

Text: ${text}`;

  const body = JSON.stringify({
    anthropic_version: "bedrock-2023-05-31",
    max_tokens: 500,
    messages: [
      {
        role: "user",
        content: prompt
      }
    ]
  });

  const command = new InvokeModelCommand({
    modelId: 'anthropic.claude-3-haiku-20240307-v1:0',
    body: body,
    contentType: 'application/json',
    accept: 'application/json'
  });

  const response = await bedrock.send(command);
  const responseBody = JSON.parse(new TextDecoder().decode(response.body));

  return JSON.parse(responseBody.content[0].text);
}

exports.handler = async (event) =&gt; {
  console.log('Event:', JSON.stringify(event));

  const body = JSON.parse(event.body);
  const text = body.text;
  const id = body.id || Date.now().toString();

  try {
    const analysis = await analyzeWithClaude(text);

    const result = {
      id: id,
      text: text,
      analyzedAt: new Date().toISOString(),
      ...analysis,
      status: analysis.isSafe ? 'APPROVED' : 'FLAGGED'
    };

    // Store in DynamoDB
    await ddb.send(new PutCommand({
      TableName: process.env.TABLE_NAME,
      Item: result
    }));

    return {
      statusCode: 200,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(result)
    };
  } catch (error) {
    console.error('Error:', error);
    return {
      statusCode: 500,
      body: JSON.stringify({ error: error.message })
    };
  }
};</code></pre>

        <p>Deploy:</p>
        <pre><div class="code-block-badges"><span class="code-service-badge">DynamoDB</span><span class="code-service-badge">Lambda</span></div><code class="language-bash">cd text-analyzer
npm init -y
npm install @aws-sdk/client-bedrock-runtime @aws-sdk/client-dynamodb @aws-sdk/lib-dynamodb
zip -r function.zip .

# Create table for text analysis
aws dynamodb create-table \
  --table-name text-analysis \
  --attribute-definitions AttributeName=id,AttributeType=S \
  --key-schema AttributeName=id,KeyType=HASH \
  --billing-mode PAY_PER_REQUEST

aws lambda create-function \
  --function-name text-content-analyzer \
  --runtime nodejs20.x \
  --role $LAMBDA_ROLE_ARN \
  --handler index.handler \
  --zip-file fileb://function.zip \
  --timeout 30 \
  --memory-size 256 \
  --environment "Variables={TABLE_NAME=text-analysis}"</code></pre>

        <h3>Step 11: Create API and Test</h3>
        <pre><div class="code-block-badges"><span class="code-service-badge">API Gateway</span><span class="code-service-badge">Lambda</span><span class="code-service-badge">STS</span></div><code class="language-bash"># Create API Gateway (HTTP API)
aws apigatewayv2 create-api \
  --name content-moderation-api \
  --protocol-type HTTP \
  --target $(aws lambda get-function --function-name text-content-analyzer --query 'Configuration.FunctionArn' --output text)

export API_ID=$(aws apigatewayv2 get-apis --query "Items[?Name=='content-moderation-api'].ApiId" --output text)

aws lambda add-permission \
  --function-name text-content-analyzer \
  --statement-id apigateway-invoke \
  --action lambda:InvokeFunction \
  --principal apigateway.amazonaws.com \
  --source-arn "arn:aws:execute-api:us-east-1:$(aws sts get-caller-identity --query Account --output text):$API_ID/*/*"

export API_ENDPOINT=$(aws apigatewayv2 get-apis --query "Items[?Name=='content-moderation-api'].ApiEndpoint" --output text)

echo "API Endpoint: $API_ENDPOINT"

# Test text analysis
curl -X POST $API_ENDPOINT \
  -H "Content-Type: application/json" \
  -d '{
    "text": "This is a wonderful day! I love learning about AWS."
  }'</code></pre>
      </div>

      <!-- Navigation -->
      <div class="step-navigation">
        <div class="nav-button-group">
          <a href="lesson-09.html" class="btn btn-secondary">← Previous: Image Analysis with Rekognition</a>
          <a href="lesson-09-3.html" class="btn btn-primary">Next: Additional AI Services →</a>
        </div>
      </div>
    </main>
  </div>

  <script src="../assets/script.js"></script>
</body>
</html>
