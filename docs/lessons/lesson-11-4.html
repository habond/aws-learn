<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lesson 11: Security Deep Dive - AWS Learning Tutorial</title>

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>☁️</text></svg>">
  <link rel="stylesheet" href="../assets/style.css">
  <!-- Highlight.js for syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <!-- Additional language support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
  <script src="../assets/terraform.js"></script>
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1><a href="../index.html">AWS Learning</a></h1>
      </div>

      <div class="lesson-info">
        <h2>Lesson 11</h2>
        <div class="lesson-title">Security Deep Dive</div>
        <div class="lesson-meta">
          <span>~8 hours</span>
          <span>$2-3</span>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-bar">
        <div class="progress-fill" style="width: 57.1%;"></div>
      </div>
      <div class="progress-text">Step 4 of 7</div>

      <!-- Table of Contents -->
      <nav class="toc">
        <h3>In This Lesson</h3>
        <ul>
          <li>
<a href="lesson-11.html">
<span class="step-number">1</span>
<span class="step-title">IAM Deep Dive</span>
</a>
</li>
<li>
<a href="lesson-11-2.html">
<span class="step-number">2</span>
<span class="step-title">Data Encryption with KMS</span>
</a>
</li>
<li>
<a href="lesson-11-3.html">
<span class="step-number">3</span>
<span class="step-title">GuardDuty Threat Detection</span>
</a>
</li>
<li class="active">
<a href="lesson-11-4.html">
<span class="step-number">4</span>
<span class="step-title">WAF Protection</span>
</a>
</li>
<li>
<a href="lesson-11-5.html">
<span class="step-number">5</span>
<span class="step-title">CloudTrail Auditing</span>
</a>
</li>
<li>
<a href="lesson-11-6.html">
<span class="step-number">6</span>
<span class="step-title">Security Hub</span>
</a>
</li>
<li>
<a href="lesson-11-7.html">
<span class="step-number">7</span>
<span class="step-title">Secrets Rotation &amp; Cleanup</span>
</a>
</li>

        </ul>
      </nav>

      <!-- All Lessons -->
      <div class="all-lessons">
  <h3>All Lessons</h3>
  <ul>
    <li>
      <a href="lesson-01.html">1. Your First Internet Empire</a>
    </li>
    <li>
      <a href="lesson-02.html">2. Renting Computers</a>
    </li>
    <li>
      <a href="lesson-03.html">3. Databases That Don&#39;t Die</a>
    </li>
    <li>
      <a href="lesson-04.html">4. Containers &amp; Orchestration</a>
    </li>
    <li>
      <a href="lesson-05.html">5. Serverless Computing</a>
    </li>
    <li>
      <a href="lesson-06.html">6. Data Pipelines</a>
    </li>
    <li>
      <a href="lesson-07.html">7. Event-Driven Chaos</a>
    </li>
    <li>
      <a href="lesson-08.html">8. Big Data Analytics</a>
    </li>
    <li>
      <a href="lesson-09.html">9. AI/ML Buzzwords</a>
    </li>
    <li>
      <a href="lesson-10.html">10. Observability</a>
    </li>
    <li class="current">
      <a href="lesson-11.html">11. Security Deep Dive</a>
    </li>
    <li>
      <a href="lesson-12.html">12. Final Project</a>
    </li>
  </ul>
</div>

    </aside>

    <!-- Main Content -->
    <main class="content">
      
<div class="step-header">
        <span class="step-badge">Lesson 11 - Part 4</span>
        <h1>WAF (Web Application Firewall)</h1>
      </div>

      <div class="step-content">
        <h2>Part 4: WAF (Web Application Firewall) (1.5 hours)</h2>

        <h3>Step 12: Create WAF Web ACL</h3>
        <pre><code class="language-bash"># Create web ACL
aws wafv2 create-web-acl \
  --name api-protection-acl \
  --scope REGIONAL \
  --region us-east-1 \
  --default-action Allow={} \
  --rules '[
    {
      "Name": "RateLimitRule",
      "Priority": 1,
      "Statement": {
        "RateBasedStatement": {
          "Limit": 2000,
          "AggregateKeyType": "IP"
        }
      },
      "Action": {
        "Block": {}
      },
      "VisibilityConfig": {
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "RateLimitRule"
      }
    },
    {
      "Name": "BlockSQLInjection",
      "Priority": 2,
      "Statement": {
        "SqliMatchStatement": {
          "FieldToMatch": {
            "QueryString": {}
          },
          "TextTransformations": [
            {
              "Priority": 0,
              "Type": "URL_DECODE"
            }
          ]
        }
      },
      "Action": {
        "Block": {}
      },
      "VisibilityConfig": {
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "BlockSQLInjection"
      }
    }
  ]' \
  --visibility-config \
    SampledRequestsEnabled=true,CloudWatchMetricsEnabled=true,MetricName=ApiProtectionACL

export WEB_ACL_ARN=$(aws wafv2 list-web-acls \
  --scope REGIONAL \
  --region us-east-1 \
  --query "WebACLs[?Name=='api-protection-acl'].ARN" \
  --output text)

echo "Web ACL ARN: $WEB_ACL_ARN"</code></pre>

        <h3>Step 13: Associate WAF with API Gateway</h3>
        <pre><code class="language-bash"># Get API Gateway stage ARN
export API_STAGE_ARN="arn:aws:apigateway:us-east-1::/restapis/$API_ID/stages/prod"

# Associate WAF with API Gateway
aws wafv2 associate-web-acl \
  --web-acl-arn $WEB_ACL_ARN \
  --resource-arn $API_STAGE_ARN \
  --region us-east-1</code></pre>

        <div style="background: var(--warning-bg); border-left: 4px solid var(--warning-color); padding: 15px; margin: 20px 0;">
          <strong>Note:</strong> Make sure you have an API Gateway from a previous lesson. If you don't have an API_ID set, you can find it with: <code>aws apigateway get-rest-apis --query 'items[0].id' --output text</code>
        </div>

        <h3>Step 14: Add AWS Managed WAF Rules</h3>
        <pre><code class="language-bash"># Add AWS managed rule groups
aws wafv2 update-web-acl \
  --name api-protection-acl \
  --scope REGIONAL \
  --region us-east-1 \
  --id $(echo $WEB_ACL_ARN | cut -d'/' -f3) \
  --lock-token $(aws wafv2 get-web-acl --name api-protection-acl --scope REGIONAL --region us-east-1 --id $(echo $WEB_ACL_ARN | cut -d'/' -f3) --query 'LockToken' --output text) \
  --default-action Allow={} \
  --visibility-config \
    SampledRequestsEnabled=true,CloudWatchMetricsEnabled=true,MetricName=ApiProtectionACL \
  --rules '[
    {
      "Name": "AWSManagedRulesCommonRuleSet",
      "Priority": 0,
      "Statement": {
        "ManagedRuleGroupStatement": {
          "VendorName": "AWS",
          "Name": "AWSManagedRulesCommonRuleSet"
        }
      },
      "OverrideAction": {
        "None": {}
      },
      "VisibilityConfig": {
        "SampledRequestsEnabled": true,
        "CloudWatchMetricsEnabled": true,
        "MetricName": "AWSManagedRulesCommonRuleSet"
      }
    }
  ]'</code></pre>

        <div style="background: var(--info-bg); border-left: 4px solid var(--info-color); padding: 15px; margin: 20px 0;">
          <strong>What's happening?</strong> WAF sits in front of your API and blocks malicious requests before they reach your application. The rate limit rule prevents DDoS attacks, the SQL injection rule protects your database, and AWS managed rules provide protection against common web exploits.
        </div>
      </div>

      <!-- Navigation -->
      <div class="step-navigation">
        <div class="nav-button-group">
          <a href="lesson-11-3.html" class="btn btn-secondary">← Previous: GuardDuty Threat Detection</a>
          <a href="lesson-11-5.html" class="btn btn-primary">Next: CloudTrail Auditing →</a>
        </div>
      </div>
    </main>
  </div>

  <script src="../assets/script.js"></script>
</body>
</html>
